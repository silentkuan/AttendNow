

@model AttendNow.Models.SP_GetFactorys_Result
@using AttendNow.Models

@{

    var factoryAccess = ViewBag.factoryAccess as sys_setting_role_permission;

    if (ViewBag.Title == "Add Factory")
    {
        if (factoryAccess?.status != true || (factoryAccess?.addFunction != true))
        {

            <script>
                    window.location.href = '@Url.Action("Logout", "User")';
            </script>
        }
    }
    else
    {
        if (factoryAccess?.status != true || (factoryAccess?.editFunction != true && factoryAccess?.viewFunction != true))
        {

            <script>
                     window.location.href = '@Url.Action("Logout", "User")';
            </script>
        }
    }


}
@using (Html.BeginForm("", "", FormMethod.Post))
{

    <div class="form-group  row">
        <label class="col-sm-2 col-form-label">Factory ID <span class="text-danger">*</span></label>


        <div class="col-sm-10">
            @if ((ViewBag.Title == "View Factory" || ViewBag.Title == "Edit Factory") && ViewBag.ErrorMessage == null)
            {
                <label class="col-form-label">@Model.factory_id.ToUpper()</label>
                @Html.EditorFor(model => model.factory_id, new { htmlAttributes = new { @class = "form-control", id = "factory_id", type = "hidden" } })
            }
            else
            {
                @Html.EditorFor(model => model.factory_id, new { htmlAttributes = new { @class = "form-control", id = "factory_id" } })
                <span id="factory_id_error" class="text-danger"></span>
            }


        </div>
    </div>
    <div class="form-group row">
        <label class="col-sm-2 col-form-label">Name <span class="text-danger">*</span></label>
        <div class="col-sm-10">
            @if (ViewBag.Title == "View Factory" && ViewBag.ErrorMessage == null)
            {
                <label class="col-form-label">@Model.name</label>
            }
            else
            {
                @Html.EditorFor(model => model.name, new
           {
               htmlAttributes = new
               {
                   @class = "form-control",
                   id = "name",
                   onKeypress = Model != null ? "if(event.keyCode === 13) { funcAddorEdit('Edit') }" : "if(event.keyCode === 13) { funcAddorEdit('Create') }"
               }
           })
                <span id="name_error" class="text-danger"></span>
            }

        </div>
    </div>


}
<div class="form-group row">
    <div class="col-sm-4 col-sm-offset-2">
        @if (ViewBag.Title == "Add Factory" && ViewBag.ErrorMessage == null)
        {
            <section class="progress-demo">
                <button class="ladda-button btn btn-primary" data-style="zoom-in" onclick="funcAddorEdit('Create')">Add</button>
            </section>
        }
        else if (ViewBag.Title == "Edit Factory" && ViewBag.ErrorMessage == null)
        {
            <section class="progress-demo">
                <button class="ladda-button btn btn-primary" data-style="zoom-in" onclick="funcAddorEdit('Edit')">Update</button>
                </section>
                }

        </div>
</div>
<script>
    $(document).ready(function () {
        Ladda.bind('.progress-demo .ladda-button', {
            callback: function (instance) {

                var interval = setInterval(function () {

                    if (returnMessage != "") {
                        instance.stop();
                        clearInterval(interval);
                        returnMessage = "";
                    }
                }, 200);
            }
        });
    });
    function funcAddorEdit(action) {
        var isValid = true; // Flag to check overall form validity

        if (!validateField("factory_id", "Factory Code field is required.")) {
            isValid = false;
        }

        if (!validateField("name", "Name field is required.")) {
            isValid = false;
        }


        if (!isValid) {
            errorMessage("Please make sure all required fields is filled");
            returnMessage = "Please make sure all required fields is filled";
            return;
        }

        var factoryData = {
            factory_id: $("#factory_id").val(),
            name: $("#name").val()
        }



        // Make an AJAX request
        $.ajax({
            type: "POST",
            url: "/Factory/"+action, // Replace with the actual URL
            data: JSON.stringify({ FactoryData: factoryData }),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    
                    window.location.href = '@Url.Action("MainForm", "Factory", new { id = "" })' + "/" + factoryData.factory_id;


                } else {
                    errorMessage(data.error_message);
                    returnMessage = data.error_message;
                    if (data.idError) {
                        $("#factory_id").parent().addClass("has-error");
                    } else {
                        $("#factory_id").parent().removeClass("has-error");
                    }
                }
            },
            error: function (data) {
                errorMessage(data.error_message);
                returnMessage = data.error_message;
            }
        });
    }

</script>